trigger:
- main

pool:
  vmImage: 'windows-latest'

steps:
  - script: |
      echo "Hello Rithwik, I am setting varaibles"
      echo "##vso[task.setvariable variable=rithvar1]007"
      echo "##vso[task.setvariable variable=rithvar2]008"
    name: Rith_SetVariables

  - task: PowerShell@2
    inputs:
      targetType: 'inline'
      script: |
        $r = "${env:rithvar1}"
        $r1 = "${env:rithvar2}"
        $r_uri = "https://dev.azure.com/v-scheedella/MT%20Stack%20Overflow/_apis/pipelines/21/runs?api-version=6.0-preview.1"
        $rb = @{
          resources = @{
            repositories = @{
              self = @{
                refName = "refs/heads/main"
              }
            }
          }
          templateParameters = @{
            ri_var1 = $r
            ri_var2 = $r1
          }
        } | ConvertTo-Json -Depth 10
        $ri_h = @{
          Authorization = "Bearer $env:SYSTEM_ACCESSTOKEN"
          "Content-Type" = "application/json"
        }
        Invoke-RestMethod -Uri $r_uri -Method Post -Body $rb -Headers $ri_h
    env:
      SYSTEM_ACCESSTOKEN: $(System.AccessToken)
       ri_var1: $(rithvar1)
       ri_var2: $(rithvar2)
